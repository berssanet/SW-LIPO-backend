<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <!-- 
            Shopware 6.4.20 Migration Profile
            
            By implementing Shopware6ProfileInterface, this profile automatically uses:
            - Shopware6ApiGateway (API-based migration)
            - All existing Shopware 6 API Readers (product, customer, order, etc.)
            - All existing Shopware 6 Converters
            - All existing Shopware 6 DataSets and DataSelections
            
            REQUIREMENT: The source Shopware 6.4.20 must have the 
            "Migration Connector" plugin installed and configured.
        -->
        <service id="LipoMigration64\Profile\Shopware64\Shopware64Profile">
            <tag name="shopware.migration.profile"/>
        </service>

        <!-- 
            Custom Gateway that ALLOWS migration between different major versions (6.4 -> 6.7)
            This decorates the original Shopware6ApiGateway.
            
            The key difference: we do NOT set migrationDisabled=true when versions don't match.
        -->
        <service id="LipoMigration64\Profile\Shopware64\Gateway\Api\Shopware64ApiGateway"
                 decorates="SwagMigrationAssistant\Profile\Shopware6\Gateway\Api\Shopware6ApiGateway"
                 decoration-priority="10">
            <argument type="service" id="SwagMigrationAssistant\Migration\Gateway\Reader\ReaderRegistry"/>
            <argument type="service" id="SwagMigrationAssistant\Profile\Shopware6\Gateway\Api\Reader\EnvironmentReader"/>
            <argument type="service" id="currency.repository"/>
            <argument type="service" id="language.repository"/>
            <argument type="service" id="SwagMigrationAssistant\Profile\Shopware6\Gateway\Api\Reader\TotalReader"/>
            <argument type="service" id="SwagMigrationAssistant\Profile\Shopware6\Gateway\Api\Reader\TableReader"/>
            <argument>%kernel.shopware_version%</argument>
        </service>
    </services>
</container>
